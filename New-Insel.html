<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Insel der 1000 Gefahren</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* Retro/Pixel-Schrift und allgemeiner Look */
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        .pixel-font {
            font-family: 'Press Start 2P', cursive;
            text-shadow: 2px 2px #000;
        }
        
        body {
            background-color: #383838; /* Dunkler Hintergrund */
            color: #E8E8E8;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .game-screen {
            background-color: #0F380F; /* Gameboy-Bildschirm-GrÃ¼n */
            border: 10px solid #202020;
            border-radius: 15px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8), 0 0 10px #0F380F;
            max-width: 95vw;
            width: 500px;
            min-height: 600px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .retro-button {
            background-color: #4CAF50; /* Knopffarbe */
            color: #0F380F;
            padding: 10px;
            border: 3px solid #202020;
            border-bottom: 5px solid #202020;
            cursor: pointer;
            transition: all 0.05s ease;
            box-shadow: 4px 4px #202020;
        }

        .retro-button:hover {
            background-color: #66BB6A;
        }
        
        .retro-button:active {
            box-shadow: 0 0 0 #202020;
            transform: translateY(4px);
            border-bottom: 3px solid #202020;
        }

        .game-text {
            line-height: 1.5;
            min-height: 180px;
            font-size: 14px;
            text-align: justify;
        }
        
        .visual-cue {
            font-size: 4rem;
            text-align: center;
            margin: 10px 0;
            height: 80px;
        }

        @media (max-width: 600px) {
            .pixel-font {
                font-size: 0.8rem;
            }
            .game-text {
                font-size: 12px;
            }
            .visual-cue {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body class="pixel-font">

    <div class="game-screen">
        <h1 class="text-xl text-center mb-4 text-yellow-300">DIE INSEL DER 1000 GEFAHREN</h1>
        
        <div id="visualCue" class="visual-cue">ðŸŒ´</div>

        <div id="gameText" class="game-text">
            Klicke auf START, um dein Abenteuer zu beginnen und die Musik einzuschalten!
        </div>

        <div id="choicesContainer" class="flex flex-col gap-3 mt-auto">
            <button id="startButton" class="retro-button" onclick="startGame()">SPIEL STARTEN</button>
        </div>

        <div id="musicStatus" class="text-xs text-center mt-2 text-gray-400">Musik: Aus</div>
    </div>

    <script>
        // Setze die App-ID fÃ¼r Firestore-Pfadgenerierung (wird nicht direkt genutzt, aber als Vorbereitung)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'insel-abenteuer-game';
        
        // --- Game Logic and Story State ---
        
        // Definiert die Spiel-Szenen (ca. 20 Entscheidungspunkte)
        const gameStates = {
            "S1": {
                text: "Du erwachst am feuchten Sand eines unbekannten Strandes. Dein Schiff ist zerschellt. Vor dir liegt der unheimliche, dichte Dschungel, links eine Klippe und rechts das unendliche Meer. Was tust du?",
                cue: "ðŸï¸",
                choices: [
                    { text: "Die Klippe erklimmen", next: "S2" },
                    { text: "Einen Pfad in den Dschungel suchen", next: "S3" },
                    { text: "Am Strand bleiben und nach Wrackteilen suchen", next: "S4" }
                ]
            },
            
            // --- Klippen-Pfad (Start S2) ---
            "S2": {
                text: "Der Aufstieg ist mÃ¼hsam. Nach einer Stunde erreichst du ein kleines Plateau mit einer dunklen HÃ¶hlenÃ¶ffnung. Du kannst den Pfad auch weiter zur Spitze verfolgen.",
                cue: "â›°ï¸",
                choices: [
                    { text: "Die HÃ¶hle untersuchen", next: "S5" },
                    { text: "Weiter zur Klippenspitze steigen", next: "S6" }
                ]
            },
            "S5": {
                text: "Die HÃ¶hle ist feucht und riecht nach Moder. Du hÃ¶rst ein leises, flatterndes GerÃ¤usch. Du brauchst Licht.",
                cue: "ðŸ¦‡",
                choices: [
                    { text: "Versuchen, ein schnelles Feuer zu machen", next: "S11" },
                    { text: "Ganz leise in die Tiefe schleichen", next: "S12" }
                ]
            },
            "S11": {
                text: "Das Feuer spendet Licht, aber der Rauch zieht sofort die Aufmerksamkeit von etwas GroÃŸem, Pelzigem in der HÃ¶hle auf sich. Es kommt auf dich zu!",
                cue: "ðŸ‘¹",
                choices: [
                    { text: "Versuchen, das Wesen zu bekÃ¤mpfen", next: "E1" }, // Kampf-Ende
                    { text: "Weglaufen und zurÃ¼ck zum Plateau", next: "S6" }
                ]
            },
            "S12": {
                text: "Du schleichst durch die HÃ¶hle und findest einen engen Durchgang. Dahinter liegt eine Schatzkammer mit GoldmÃ¼nzen und einem alten FunkgerÃ¤t. Du sendest ein Notsignal!",
                cue: "ðŸ†",
                choices: [
                    { text: "SPIEL ENDE (Schatz und Rettung!)", next: "E2" } 
                ]
            },
            "S6": {
                text: "Du erreichst die Spitze der Klippe. Von hier aus hast du einen weiten Blick Ã¼ber die Insel. Du siehst eine Rauchfahne am Horizont.",
                cue: "ðŸ”­",
                choices: [
                    { text: "Ein riesiges Signalfeuer entzÃ¼nden", next: "S13" },
                    { text: "Die Klippe auf der anderen Seite zum Fluss hinuntersteigen", next: "S14" }
                ]
            },
            "S13": {
                text: "Dein Signalfeuer wird bemerkt. Nach Stunden siehst du ein Rettungsboot, das auf dich zukommt. Du bist gerettet!",
                cue: "ðŸš¢",
                choices: [
                    { text: "SPIEL ENDE (Rettung)", next: "E2" } 
                ]
            },
            "S14": {
                text: "Der Abstieg ist tÃ¼ckisch. Du rutschst auf nassem Moos aus und verletzt dich schwer am Bein. Du kannst dich kaum noch bewegen. Die Nacht bricht herein.",
                cue: "ðŸš‘",
                choices: [
                    { text: "SPIEL ENDE (Verletzt und allein)", next: "E3" } 
                ]
            },
            
            // --- Dschungel-Pfad (Start S3) ---
            "S3": {
                text: "Der Dschungel ist ein Labyrinth aus Lianen und dichtem Laub. Die Sonne dringt kaum hindurch. Du hÃ¶rst das Rauschen von Wasser in der Ferne.",
                cue: "ðŸŒ³",
                choices: [
                    { text: "Direkt in Richtung des Flussrauschens gehen", next: "S7" },
                    { text: "Einem schwachen Trampelpfad zu einer alten Ruine folgen", next: "S8" }
                ]
            },
            "S7": {
                text: "Du erreichst den Fluss. Das Wasser ist trÃ¼b. Am Ufer liegt ein riesiger Baumstamm, der perfekt als BrÃ¼cke dienen kÃ¶nnte. Du bemerkst aber auch eine dunkle Bewegung unter der OberflÃ¤che.",
                cue: "ðŸŠ",
                choices: [
                    { text: "Ãœber den Baumstamm balancieren", next: "S15" },
                    { text: "Einen anderen Weg flussaufwÃ¤rts suchen", next: "S16" }
                ]
            },
            "S15": {
                text: "Das Krokodil ist schneller als du dachtest. Es taucht auf und reiÃŸt dich vom Baumstamm. Du kannst dich nicht wehren.",
                cue: "âŒ",
                choices: [
                    { text: "SPIEL ENDE (Gefressen)", next: "E3" } 
                ]
            },
            "S16": {
                text: "Du gehst tiefer in das Dickicht. PlÃ¶tzlich stehst du vor einer Wand aus hochgiftigen Schlangen, die in den BÃ¤umen lauern. Ein ZurÃ¼ck ist schwierig.",
                cue: "ðŸ",
                choices: [
                    { text: "Trotz der Schlangen versuchen, den Weg zu durchqueren", next: "S17" },
                    { text: "Einen gefÃ¤hrlichen RÃ¼ckweg zum Fluss antreten", next: "S7" }
                ]
            },
            "S17": {
                text: "Du schleichst vorsichtig. Die Schlangen ignorieren dich. Du findest einen kleinen Tempel in der Mitte des Dickichts. Dort liegt ein vergessener, aber vollstÃ¤ndiger Notfallrucksack.",
                cue: "ðŸŽ’",
                choices: [
                    { text: "Mit dem Rucksack zum Fluss gehen", next: "S7" } // ZurÃ¼ck, aber besser ausgerÃ¼stet!
                ]
            },
            "S8": {
                text: "Die Ruine ist beeindruckend, von Lianen Ã¼berwuchert. Du findest eine Steinplatte mit seltsamen Symbolen und einer GeheimtÃ¼r, die nur mit einem Hebel geÃ¶ffnet werden kann.",
                cue: "ðŸ›•",
                choices: [
                    { text: "Den Hebel ziehen", next: "S18" },
                    { text: "Die Ruine weiter nach nÃ¼tzlichen GegenstÃ¤nden erkunden", next: "S19" }
                ]
            },
            "S18": {
                text: "Der Hebel lÃ¶st eine Falle aus! Eine Steinplatte fÃ¤llt von der Decke und versperrt den Ausgang. Du bist gefangen.",
                cue: "ðŸª¦",
                choices: [
                    { text: "SPIEL ENDE (Gefangen)", next: "E3" } 
                ]
            },
            "S19": {
                text: "Hinter einer umgestÃ¼rzten SÃ¤ule findest du eine Schatzkarte! Ein groÃŸes, rotes 'X' markiert eine Stelle am anderen Ende der Insel.",
                cue: "ðŸ—ºï¸",
                choices: [
                    { text: "Sofort dem 'X' auf der Karte folgen", next: "S20" },
                    { text: "ZurÃ¼ck zum Strand gehen, um VorrÃ¤te zu sammeln", next: "S4" }
                ]
            },
            "S20": {
                text: "Nach einer langen Wanderung erreichst du die markierte Stelle. Dort findest du... nichts. Nur einen weiteren, leeren Strand. Entmutigt verbringst du die Nacht.",
                cue: "ðŸ˜”",
                choices: [
                    { text: "SPIEL ENDE (Verschwendete Zeit)", next: "E3" } 
                ]
            },

            // --- Strand-Pfad (Start S4) ---
            "S4": {
                text: "Du bleibst am Strand. Die Sonne brennt. Die Ebbe legt einige flache Felsen frei. Du bist hungrig und musst die Nacht Ã¼berstehen.",
                cue: "â˜€ï¸",
                choices: [
                    { text: "Versuchen, Fische in den Gezeitenpools zu fangen", next: "S9" },
                    { text: "Eine provisorische SchutzhÃ¼tte bauen", next: "S10" }
                ]
            },
            "S9": {
                text: "Du fÃ¤ngst einen groÃŸen, farbenprÃ¤chtigen Fisch! Er sieht lecker aus, aber du bist unsicher, ob er giftig ist. Du hast kein Werkzeug, um ihn gut zu braten.",
                cue: "ðŸ ",
                choices: [
                    { text: "Ihn roh essen (Du bist zu hungrig!)", next: "E4" }, // Gift-Ende
                    { text: "Ihn vergraben und nach essbaren Pflanzen suchen", next: "S3" } // In den Dschungel
                ]
            },
            "S10": {
                text: "Deine HÃ¼tte ist notdÃ¼rftig. Am Abend zieht ein starker Sturm auf. Das Dach droht jeden Moment weggeweht zu werden.",
                cue: "â›ˆï¸",
                choices: [
                    { text: "Das Dach mit Seilen (Lianen) verstÃ¤rken", next: "S13" }, // Rettung durch Zufall (FÃ¼hrt zu S13)
                    { text: "In den Dschungel fliehen, um Schutz zu suchen", next: "S3" }
                ]
            },
            
            // --- ENDEN ---
            "E1": {
                text: "Du kÃ¤mpfst tapfer gegen das HÃ¶hlenwesen, aber es ist zu stark und schnell. Das ist das Ende deines Abenteuers.",
                cue: "âš°ï¸",
                choices: [{ text: "Neues Spiel starten", next: "S1" }]
            },
            "E2": {
                text: "Du hast Ã¼berlebt! Du verlÃ¤sst die Insel, reich an Erfahrung oder reich an Gold. Du bist ein Ãœberlebender der 1000 Gefahren!",
                cue: "ðŸŽ‰",
                choices: [{ text: "Neues Spiel starten", next: "S1" }]
            },
            "E3": {
                text: "Ein unglÃ¼ckliches Ende. Die Insel war dir zu feindselig gesinnt. Versuch es beim nÃ¤chsten Mal mit einer anderen Entscheidung.",
                cue: "ðŸ¥€",
                choices: [{ text: "Neues Spiel starten", next: "S1" }]
            },
            "E4": {
                text: "Der Fisch war giftig! Du spÃ¼rst ein Brennen im Magen und verlierst langsam das Bewusstsein.",
                cue: "ðŸ¤®",
                choices: [{ text: "Neues Spiel starten", next: "S1" }]
            }
        };

        let currentSceneId = "S1";
        
        // --- Music/Tone.js Setup ---
        const synth = new Tone.Synth({
            oscillator: { type: "square" },
            envelope: {
                attack: 0.005,
                decay: 0.1,
                sustain: 0.2,
                release: 1
            }
        }).toDestination();

        // Einfache Gameboy-Melodie (vier TÃ¶ne, sich wiederholend)
        const notes = ["C4", "E4", "G4", "C5", "G4", "E4"];
        const sequence = new Tone.Sequence((time, note) => {
            synth.triggerAttackRelease(note, "8n", time);
        }, notes, "4n").start(0);

        sequence.loop = true;
        
        let isMusicPlaying = false;

        async function toggleMusic() {
            if (!isMusicPlaying) {
                await Tone.start();
                Tone.Transport.start();
                isMusicPlaying = true;
                document.getElementById('musicStatus').textContent = "Musik: Spielt ðŸŽ¶";
            } else {
                Tone.Transport.stop();
                isMusicPlaying = false;
                document.getElementById('musicStatus').textContent = "Musik: Aus";
            }
        }
        
        // --- Game Functions ---

        function updateScreen(sceneId) {
            const scene = gameStates[sceneId];
            if (!scene) {
                console.error("Szene nicht gefunden:", sceneId);
                return;
            }

            currentSceneId = sceneId;
            
            // Text aktualisieren
            document.getElementById('gameText').textContent = scene.text;
            
            // Visuelle Anzeige aktualisieren (Emojis als Pixel-Grafik-Ersatz)
            document.getElementById('visualCue').textContent = scene.cue;
            
            // Entscheidungen aktualisieren
            const container = document.getElementById('choicesContainer');
            container.innerHTML = ''; // Vorherige Buttons entfernen
            
            scene.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'retro-button pixel-font text-sm';
                button.textContent = choice.text;
                button.onclick = () => makeChoice(choice.next);
                container.appendChild(button);
            });
            
            // Musiksteuerung nur in der Spielszene anzeigen, nicht im Startbildschirm
            if (sceneId !== "S1") {
                 // FÃ¼ge den Neustart-Button hinzu, wenn es ein Endzustand ist
                if (sceneId.startsWith('E')) {
                    const restartButton = document.createElement('button');
                    restartButton.className = 'retro-button pixel-font text-sm mt-4 bg-red-500 hover:bg-red-600';
                    restartButton.textContent = 'NEUSTART';
                    restartButton.onclick = () => startGame(true); // Startet das Spiel neu ohne Musik-Toggle
                    container.appendChild(restartButton);
                } else {
                    // FÃ¼ge den Musik-Toggle hinzu, wenn es keine Endszene ist
                    const musicToggle = document.createElement('button');
                    musicToggle.className = 'retro-button pixel-font text-xs mt-4 bg-gray-500 hover:bg-gray-600';
                    musicToggle.textContent = isMusicPlaying ? 'MUSIK AUS' : 'MUSIK AN';
                    musicToggle.onclick = toggleMusic;
                    container.appendChild(musicToggle);
                }
            }
        }

        function startGame(isRestart = false) {
            if (!isRestart) {
                 toggleMusic(); // Starte die Musik beim ersten Klick
            }
            // Setze auf die erste Szene
            updateScreen("S1");
            // Verstecke den Start-Button, wenn das Spiel lÃ¤uft
            const startButton = document.getElementById('startButton');
            if(startButton) {
                startButton.style.display = 'none';
            }
        }

        function makeChoice(nextSceneId) {
            updateScreen(nextSceneId);
        }

        // Initialisiere den Bildschirm auf dem Start-Zustand (da die Musik erst durch Nutzerinteraktion starten darf)
        updateScreen(currentSceneId);

    </script>
</body>
</html>
