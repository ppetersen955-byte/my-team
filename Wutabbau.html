<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Wut-Abbau ‚Äì Herzschutz-Spiel</title>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    :root {
      --bg: #020617;
      --card: #0b1120;
      --accent-orange: #f97316;
      --accent-blue: #38bdf8;
      --accent-green: #22c55e;
      --accent-rose: #fb7185;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2937;
      --shadow-soft: 0 16px 40px rgba(0,0,0,0.5);
      --radius-xl: 18px;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: radial-gradient(circle at top, #1e293b 0, #020617 50%, #000 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      -webkit-text-size-adjust: 100%;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 550px;
      height: 100vh;
      padding: 10px 10px 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    header {
      text-align: center;
      padding-top: 2px;
    }

    header h1 {
      margin: 2px 0;
      font-size: 20px;
      letter-spacing: 0.03em;
    }

    header p {
      margin: 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .card {
      flex: 1;
      background: linear-gradient(145deg, #020617, #020617, #0b1120);
      border-radius: var(--radius-xl);
      padding: 8px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 0;
    }

    .badge-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      border: 1px solid #1f2937;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-rose);
    }

    .badge-soft {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.5);
      border: 1px dashed #1f2937;
    }

    .title {
      font-size: 15px;
      font-weight: 600;
    }

    .text {
      font-size: 12px;
      color: #e5e7eb;
      white-space: pre-wrap;
    }

    .playfield-wrapper {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: stretch;
      margin-top: 4px;
    }

    .playfield {
      position: relative;
      width: 100%;
      max-width: 530px;
      height: 100%;
      min-height: 260px;
      border-radius: 24px;
      background: radial-gradient(circle at center, #020617 0, #020617 45%, #020617 100%);
      overflow: hidden;
      border: 1px solid #111827;
      box-shadow: inset 0 0 40px rgba(0,0,0,0.7);
    }

    .heart {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 110px;
      height: 110px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #f97316 0, #b91c1c 60%, #450a0a 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 30px rgba(248,113,113,0.9);
      border: 2px solid rgba(248,250,252,0.5);
    }

    .heart-emoji {
      font-size: 30px;
      margin-bottom: 2px;
    }

    .heart-label {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #fee2e2;
    }

    .enemy {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 999px;
      background: radial-gradient(circle at top, rgba(248,113,113,0.2), rgba(15,23,42,0.95));
      border: 1px solid rgba(248,113,113,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      text-align: center;
      padding: 6px;
      box-shadow: 0 0 20px rgba(248,113,113,0.5);
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    .enemy-emoji {
      font-size: 16px;
      margin-bottom: 1px;
    }

    .enemy-label {
      line-height: 1.2;
    }

    .enemy.hit {
      background: radial-gradient(circle at center, rgba(34,197,94,0.7), rgba(15,23,42,1));
      border-color: rgba(74,222,128,0.9);
      box-shadow: 0 0 22px rgba(74,222,128,0.8);
    }

    .enemy.missed {
      background: radial-gradient(circle at center, rgba(248,113,113,0.9), rgba(15,23,42,1));
      border-color: rgba(248,113,113,1);
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .status-row strong {
      color: var(--text-main);
    }

    .nav-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 6px;
    }

    .nav-btn {
      flex: 1;
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 12px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .nav-btn span.icon {
      font-size: 14px;
    }

    .nav-btn.secondary {
      background: rgba(15,23,42,0.9);
      color: var(--text-muted);
      border: 1px solid #1f2937;
    }

    .nav-btn.primary {
      background: var(--accent-orange);
      color: #111827;
      font-weight: 600;
    }

    .nav-btn.primary:disabled {
      opacity: 0.5;
      cursor: default;
    }

    footer {
      font-size: 10px;
      color: var(--text-muted);
      text-align: center;
      padding-bottom: 2px;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>Wut-Abbau ‚Äì Herzschutz</h1>
    <p>Tippe die Angriffe weg, bevor sie dein Herz treffen.</p>
  </header>

  <div class="card">
    <div class="badge-row">
      <div class="badge">
        <div class="badge-dot"></div>
        <span id="badge-label">Bereit?</span>
      </div>
      <div class="badge-soft" id="secondary-label"></div>
    </div>

    <div class="title" id="title">
      Dein Herz ist in der Mitte. Drumherum fliegen Angriffe, L√ºgen und Selbsthass.
    </div>
    <div class="text" id="description">
      Tippe die Kreise an, bevor sie dein Herz erreichen. Jeder Tipp ist ein ‚ÄûNein‚Äú zur L√ºge.
      Das Spiel l√§uft, bis eine Anfechtung dein Herz ber√ºhrt ‚Äì oder du 99 Angriffe abgewehrt hast.
      Ab 20, 50 und 70 wird es sp√ºrbar schwerer.
    </div>

    <div class="playfield-wrapper">
      <div class="playfield" id="playfield">
        <div class="heart" id="heart">
          <div class="heart-emoji">‚ù§Ô∏è</div>
          <div class="heart-label">MEIN HERZ</div>
        </div>
      </div>
    </div>

    <div class="status-row">
      <div>Abgewehrt: <strong id="blocked-count">0</strong> / 99</div>
      <div>Getroffen: <strong id="missed-count">0</strong></div>
    </div>

    <div class="text" id="result-text"></div>

    <div class="nav-row">
      <button class="nav-btn secondary" id="info-btn">
        <span class="icon">‚ÑπÔ∏è</span><span>Erkl√§rung</span>
      </button>
      <button class="nav-btn primary" id="start-btn">
        <span class="icon">‚ñ∂Ô∏è</span><span id="start-label">Spiel starten</span>
      </button>
    </div>
  </div>

  <footer>
    Die Angriffe sind laut ‚Äì aber Gottes Wahrheit ist tiefer als jede L√ºge.
  </footer>
</div>

<script>
  const targetBlocks = 99;

  const enemiesPool = [
    // Feind / Satan
    { label: "Satan ‚Äì Ankl√§ger", emoji: "üëø" },
    { label: "Feind ‚Äì L√ºge", emoji: "üóØÔ∏è" },
    { label: "Finsternis", emoji: "üåë" },
    { label: "Verdammnis", emoji: "‚ö°" },
    { label: "Anfechtung", emoji: "üî•" },

    // Selbsthass / Identit√§t
    { label: "Selbsthass", emoji: "üí£" },
    { label: "Ich bin nichts wert", emoji: "üíî" },
    { label: "Ich bin ein Versager", emoji: "üìâ" },
    { label: "Keiner braucht mich", emoji: "üö´" },
    { label: "Ich bin zu viel", emoji: "üß®" },

    // Zweifel / Ungewissheit
    { label: "Ungewissheit", emoji: "üå´Ô∏è" },
    { label: "Zweifel", emoji: "‚ùì" },
    { label: "Gott ist nicht da", emoji: "üö∑" },
    { label: "Das wird nie besser", emoji: "üï≥Ô∏è" },
    { label: "Angst-Gedanke", emoji: "üò®" },

    // Tods√ºnden / destruktiv
    { label: "Stolz", emoji: "üëë" },
    { label: "Neid", emoji: "üßø" },
    { label: "Zorn", emoji: "üí•" },
    { label: "Faulheit", emoji: "üõãÔ∏è" },
    { label: "Habgier", emoji: "üí∞" },
    { label: "V√∂llerei", emoji: "üçñ" },
    { label: "Unreine Gedanken", emoji: "ü©∏" },

    // Beziehung / Ablehnung
    { label: "Du bist allein", emoji: "üö™" },
    { label: "Keiner versteht dich", emoji: "üßä" },
    { label: "Du nervst alle", emoji: "üìµ" },
    { label: "Du bist schuld", emoji: "‚ö†Ô∏è" },

    // Extra
    { label: "Es lohnt sich nicht", emoji: "üß®" },
    { label: "Hoffnungslosigkeit", emoji: "üïØÔ∏è" },
    { label: "Chaos im Kopf", emoji: "üå™Ô∏è" }
  ];

  let gameRunning = false;
  let spawnTimeout = null;
  let activeEnemies = [];
  let blocked = 0;
  let missed = 0;

  const playfield = document.getElementById("playfield");
  const heartEl = document.getElementById("heart");
  const titleEl = document.getElementById("title");
  const descEl = document.getElementById("description");
  const badgeLabelEl = document.getElementById("badge-label");
  const secondaryLabelEl = document.getElementById("secondary-label");
  const blockedCountEl = document.getElementById("blocked-count");
  const missedCountEl = document.getElementById("missed-count");
  const resultTextEl = document.getElementById("result-text");
  const startBtn = document.getElementById("start-btn");
  const startLabelEl = document.getElementById("start-label");
  const infoBtn = document.getElementById("info-btn");

  function clearEnemies() {
    activeEnemies.forEach(e => clearInterval(e.intervalId));
    activeEnemies.forEach(e => {
      if (e.el && e.el.parentNode) e.el.remove();
    });
    activeEnemies = [];
  }

  function resetGameState() {
    gameRunning = false;
    blocked = 0;
    missed = 0;
    blockedCountEl.textContent = "0";
    missedCountEl.textContent = "0";
    resultTextEl.textContent = "";
    secondaryLabelEl.textContent = "";
    clearEnemies();
    if (spawnTimeout) {
      clearTimeout(spawnTimeout);
      spawnTimeout = null;
    }
  }

  function gameOverWin() {
    gameRunning = false;
    if (spawnTimeout) {
      clearTimeout(spawnTimeout);
      spawnTimeout = null;
    }
    clearEnemies();
    badgeLabelEl.textContent = "Sieg!";
    startBtn.disabled = false;
    startLabelEl.textContent = "Nochmal spielen";
    resultTextEl.textContent =
      "Gl√ºckwunsch! Du hast 99 Angriffe abgewehrt.\n\n" +
      "Du hast die Anfechtungen auf dein Herz erfolgreich abgeschmettert.\n" +
      "Gott ist bei dir ‚Äì nicht, weil du im Spiel gut bist, sondern weil du ihm vertraust.";
  }

  function gameOverLose() {
    gameRunning = false;
    if (spawnTimeout) {
      clearTimeout(spawnTimeout);
      spawnTimeout = null;
    }
    clearEnemies();
    badgeLabelEl.textContent = "Herz getroffen";
    startBtn.disabled = false;
    startLabelEl.textContent = "Nochmal spielen";

    resultTextEl.textContent =
      "Eine Anfechtung hat dein Herz getroffen.\n\n" +
      "Das hei√üt NICHT, dass du verloren hast. Es hei√üt nur: Du bist Mensch.\n" +
      "Genau dort, wo die L√ºge trifft, bleibt Jesus bei dir und sagt:\n" +
      "‚ÄûIch lasse dich nicht fallen.‚Äú";
  }

  function getSpawnDelay() {
    // Stufen: 0‚Äì19, 20‚Äì49, 50‚Äì69, 70‚Äì99
    if (blocked < 20) return 1100;
    if (blocked < 50) return 800;
    if (blocked < 70) return 550;
    return 350;
  }

  function scheduleNextSpawn() {
    if (!gameRunning) return;
    spawnEnemy();
    secondaryLabelEl.textContent = `Abgewehrt: ${blocked} / ${targetBlocks}`;
    const delay = getSpawnDelay();
    spawnTimeout = setTimeout(scheduleNextSpawn, delay);
  }

  function startGame() {
    resetGameState();
    gameRunning = true;
    startBtn.disabled = true;
    startLabelEl.textContent = "L√§uft...";
    badgeLabelEl.textContent = "Spiel l√§uft";
    descEl.textContent =
      "Tippe die Angriffe an, bevor sie dein Herz erreichen. Ab 20, 50 und 70 wird es immer dichter und chaotischer.\n" +
      "Sobald eine Anfechtung dein Herz ber√ºhrt, ist die Runde vorbei. Wenn du 99 schaffst, hast du gewonnen.";

    scheduleNextSpawn();
  }

  function choosePattern() {
    const d = blocked;
    const r = Math.random();
    if (d < 20) {
      return "straight";
    } else if (d < 50) {
      if (r < 0.6) return "straight";
      if (r < 0.85) return "zigzag";
      return "wave";
    } else if (d < 70) {
      if (r < 0.4) return "straight";
      if (r < 0.75) return "zigzag";
      return "wave";
    } else {
      if (r < 0.25) return "straight";
      if (r < 0.6) return "zigzag";
      return "wave";
    }
  }

  function spawnEnemy() {
    const centerX = 50;
    const centerY = 50;

    // Startposition am Rand
    const side = Math.floor(Math.random() * 4); // 0 top, 1 right, 2 bottom, 3 left
    let startX, startY;
    const margin = 8;

    if (side === 0) { // oben
      startX = margin + Math.random() * (100 - 2 * margin);
      startY = -8;
    } else if (side === 1) { // rechts
      startX = 108;
      startY = margin + Math.random() * (100 - 2 * margin);
    } else if (side === 2) { // unten
      startX = margin + Math.random() * (100 - 2 * margin);
      startY = 108;
    } else { // links
      startX = -8;
      startY = margin + Math.random() * (100 - 2 * margin);
    }

    const enemyData = enemiesPool[Math.floor(Math.random() * enemiesPool.length)];
    const el = document.createElement("div");
    el.className = "enemy";
    el.innerHTML = `
      <div class="enemy-emoji">${enemyData.emoji}</div>
      <div class="enemy-label">${enemyData.label}</div>
    `;
    playfield.appendChild(el);

    const vx = centerX - startX;
    const vy = centerY - startY;
    const len = Math.sqrt(vx * vx + vy * vy) || 1;
    const px = -vy / len; // senkrecht zur Flugrichtung
    const py = vx / len;

    el.style.left = startX + "%";
    el.style.top = startY + "%";

    const pattern = choosePattern();
    const enemyObj = {
      el,
      startX,
      startY,
      x: startX,
      y: startY,
      hit: false,
      pattern,
      perpX: px,
      perpY: py,
      intervalId: null
    };

    const steps = 90;
    const tickMs = 60;
    let currentStep = 0;

    function move() {
      if (!gameRunning) {
        clearInterval(enemyObj.intervalId);
        if (el.parentNode) el.remove();
        return;
      }

      currentStep++;
      let t = currentStep / steps;
      if (t > 1) t = 1;

      // seitliche Bewegung je nach Pattern
      let amplitude = 0;
      if (enemyObj.pattern === "zigzag") {
        const phase = Math.floor(currentStep / 6) % 2;
        amplitude = (phase === 0 ? 10 : -10);
      } else if (enemyObj.pattern === "wave") {
        amplitude = 12 * Math.sin(currentStep / 7);
      }

      enemyObj.x = enemyObj.startX + (centerX - enemyObj.startX) * t + enemyObj.perpX * amplitude;
      enemyObj.y = enemyObj.startY + (centerY - enemyObj.startY) * t + enemyObj.perpY * amplitude;

      el.style.left = enemyObj.x + "%";
      el.style.top = enemyObj.y + "%";

      // >>> HARTER CUT: echte Pixel-Kollision zwischen Kreisen
      const heartRect = heartEl.getBoundingClientRect();
      const enemyRect = el.getBoundingClientRect();

      const heartCenterX = heartRect.left + heartRect.width / 2;
      const heartCenterY = heartRect.top + heartRect.height / 2;
      const enemyCenterX = enemyRect.left + enemyRect.width / 2;
      const enemyCenterY = enemyRect.top + enemyRect.height / 2;

      const dx = enemyCenterX - heartCenterX;
      const dy = enemyCenterY - heartCenterY;
      const dist = Math.sqrt(dx * dx + dy * dy);

      const heartRadius = heartRect.width / 2;
      const enemyRadius = enemyRect.width / 2;

      if (dist <= heartRadius + enemyRadius) {
        // Kreise ber√ºhren sich ‚Üí sofort Game Over
        clearInterval(enemyObj.intervalId);
        if (!enemyObj.hit && gameRunning) {
          enemyObj.hit = true;
          missed++;
          missedCountEl.textContent = missed.toString();
          el.classList.add("missed");
          setTimeout(() => {
            if (el.parentNode) el.remove();
            gameOverLose();
          }, 80);
        }
      }

      // Sicherheitsabschaltung, falls irgendwas h√§ngen bleibt
      if (currentStep > steps + 30) {
        clearInterval(enemyObj.intervalId);
        if (el.parentNode) el.remove();
      }
    }

    enemyObj.intervalId = setInterval(move, tickMs);
    activeEnemies.push(enemyObj);

    el.addEventListener("click", () => {
      if (!gameRunning) return;
      if (enemyObj.hit) return;
      enemyObj.hit = true;
      blocked++;
      blockedCountEl.textContent = blocked.toString();
      el.classList.add("hit");

      setTimeout(() => {
        clearInterval(enemyObj.intervalId);
        if (el.parentNode) el.remove();
      }, 160);

      if (blocked >= targetBlocks && gameRunning) {
        gameOverWin();
      }
    });
  }

  infoBtn.addEventListener("click", () => {
    titleEl.textContent = "Was hier eigentlich passiert:";
    descEl.textContent =
      "Die Kreise stehen f√ºr Gedanken und Angriffe: L√ºgen, Selbsthass, Stimmen des Feindes.\n\n" +
      "Wenn du sie antippst, sagst du innerlich: ‚ÄûNein. Das ist nicht Gottes Wahrheit √ºber mich.‚Äú\n\n" +
      "Je mehr du abwehrst, desto dichter und chaotischer wird es ‚Äì so wie im echten Leben. " +
      "Und trotzdem gilt: Deine Identit√§t h√§ngt nicht davon ab, wie gut du klickst, sondern daran, was Jesus √ºber dich sagt.";
  });

  startBtn.addEventListener("click", () => {
    if (!gameRunning) {
      startGame();
    }
  });
</script>
</body>
</html>
